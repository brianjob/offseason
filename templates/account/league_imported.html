{% extends "base.html" %}
{% block content %}
<div class="container">
<table class="table">
	<thead>
		<tr><th>Team</th><th>Imported</th></tr>
	</thead>
	<tbody>
		{% for team in league.team_set.all %}
		<tr class="team-row" data-id="{{team.id}}">
			<td>{{team.name}}</td>
			<td class="result"><i class="glyphicon glyphicon-unchecked"></i></td>
		</tr>
		{% endfor %}
	</tbody>
</table>
</div>
<script type="text/javascript">
$(function() {
	$(".team-row").each(function() {
		var id = $(this).data('id');
		var result = $(this).children('.result');

		fill_roster(id, "{{access_token}}")
		$.post("{% url 'account:fill_roster' %}",
		{
			team_id : id,
			access_token : "{{access_token}}"

		}).done(function(data) {
			data = JSON.parse(data);
			if (data.result == 'success') {
				result.children('i').removeClass('glyphicon-unchecked')
				.addClass('glyphicon-ok');
			} else {
				result.children('i').removeClass('glyphicon-unchecked')
				.addClass('glyphicon-remove');
			}
		})
		.fail(function(err) {
			var icon = result.children('i');
			icon.removeClass('glyphicon-unchecked');
			icon.addClass('glyphicon-repeat');
			});
		});
	});
})

function fill_roster(id, access_token) {
	$.post("{% url 'account:fill_roster' %}",
	{
		team_id : id,
		access_token : access_token

	}).done(function(data) {
		data = JSON.parse(data);
		if (data.result == 'success') {
			var icon = result.children('i');
			icon.removeClass('glyphicon-unchecked');
			icon.addClass('glyphicon-ok');
			icon.unbind('click');
		} else {
			result.children('i').removeClass('glyphicon-unchecked')
			.addClass('glyphicon-remove');
		}
	}).fail(function(err) {
		var icon = result.children('i');
		icon.removeClass('glyphicon-unchecked');
		icon.addClass('glyphicon-repeat');
		icon.click(function() {
			fill_roster(id, access_token);
		});
	});
}
</script>
{% endblock %}
